"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5477],{15477:(e,t,a)=>{a.d(t,{H:()=>q});var n,s,r=a(68404),o=a(18745),l=a(90923),i=a(22584),c=a(52772),u=a(36636),d=a(16695),h=a(3490),g=a(45916);function p(e){let{dataSourceName:t,isDefault:a,onDefaultChange:n,onNameChange:s,alertingSupported:r}=e;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(f,{enabled:r}),(0,g.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,g.jsxs)("div",{className:"gf-form-inline",children:[(0,g.jsx)("div",{className:"gf-form max-width-30",children:(0,g.jsx)(h.InlineField,{label:"Name",tooltip:"The name is used when you select the data source in panels. The default data source is 'preselected in new panels.",grow:!0,children:(0,g.jsx)(h.Input,{id:"basic-settings-name",type:"text",value:t,placeholder:"Name",onChange:e=>s(e.currentTarget.value),required:!0,"aria-label":d.wl.pages.DataSource.name})})}),(0,g.jsx)(h.InlineField,{label:"Default",labelWidth:8,children:(0,g.jsx)(h.InlineSwitch,{id:"basic-settings-default",value:a,onChange:e=>{n(e.currentTarget.checked)}})})]})})]})}function f(e){let{enabled:t}=e;const a=(0,h.useStyles2)(m);return(0,g.jsx)("div",{className:a.badge,children:t?n||(n=(0,g.jsx)(h.Badge,{color:"green",icon:"check-circle",text:"Alerting supported"})):s||(s=(0,g.jsx)(h.Badge,{color:"orange",icon:"exclamation-triangle",text:"Alerting not supported"}))})}const m=e=>({badge:u.css`
    margin-bottom: ${e.spacing(2)};
  `});var x=a(98163),v=a(47570);function b(e){let{canSave:t,canDelete:a,onDelete:n,onSubmit:s,onTest:r,exploreUrl:o}=e;const l=x.Vt.hasPermission(v.bW.DataSourcesExplore);return(0,g.jsxs)("div",{className:"gf-form-button-row",children:[(0,g.jsx)(h.Button,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back(),children:"Back"}),(0,g.jsx)(h.LinkButton,{variant:"secondary",fill:"solid",href:o,disabled:!l,children:"Explore"}),(0,g.jsx)(h.Button,{type:"button",variant:"destructive",disabled:!a,onClick:n,"aria-label":d.wl.pages.DataSource.delete,children:"Delete"}),t&&(0,g.jsx)(h.Button,{type:"submit",variant:"primary",disabled:!t,onClick:e=>s(e),"aria-label":d.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!t&&(0,g.jsx)(h.Button,{variant:"primary",onClick:r,children:"Test"})]})}var S=a(12011),j=a(53772),y=a(78837);function D(e){var t;let{dataSource:a}=e,n="",s="";if(a.readOnly||(null!==(t=a.version)&&void 0!==t?t:0)>2)return null;if(y.vc.buildInfo.edition!==S.e.OpenSource)return null;switch(a.type){case"prometheus":n="Prometheus",s="Loki";break;case"loki":n="Loki",s="Prometheus";break;default:return null}return(0,g.jsx)(j.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(e,t)=>e?null:(0,g.jsxs)(h.Alert,{title:`Configure your ${n} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{t(!0)},children:["Or skip the effort and get ",n," (and ",s,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,g.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${a.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})}function C(){return(0,g.jsx)(h.Alert,{"aria-label":d.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}var w,k;function I(e){let{dataSourceRights:t,onDelete:a}=e;const{readOnly:n,hasDeleteRights:s}=t,r=!n&&s;return(0,g.jsxs)(g.Fragment,{children:[n&&(w||(w=(0,g.jsx)(C,{}))),(0,g.jsxs)("div",{className:"gf-form-button-row",children:[r&&(0,g.jsx)(h.Button,{type:"submit",variant:"destructive",onClick:a,children:"Delete"}),(0,g.jsx)(h.Button,{variant:"secondary",fill:"outline",type:"button",onClick:()=>history.back(),children:"Back"})]})]})}function P(){return k||(k=(0,g.jsx)(h.Alert,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}function M(e){let{plugin:t,pageId:a}=e;if(!t||!t.configPages)return null;const n=t.configPages.find((e=>{let{id:t}=e;return t===a}));return n?(0,g.jsx)(n.body,{plugin:t,query:{}}):(0,g.jsxs)("div",{children:["Page not found: ",n]})}var N=a(82897);function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class T extends r.PureComponent{constructor(e){super(e),B(this,"element",null),B(this,"component",void 0),B(this,"scopeProps",void 0),B(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,N.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,l.getAngularLoader)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var a;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,N.cloneDeep)(this.props.dataSource),null===(a=this.component)||void 0===a||a.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,g.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&r.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var E,O,A,U,R=a(30978);function W(e){let{state:t}=e;return(0,g.jsxs)("div",{className:"gf-form",children:[E||(E=(0,g.jsx)("label",{className:"gf-form-label width-10",children:"Plugin state"})),(0,g.jsx)("label",{className:"gf-form-label gf-form-label--transparent",children:(0,g.jsx)(R.u,{state:t})})]})}function F(e){var t,a;let{testingStatus:n}=e;const s="error"===(null==n?void 0:n.status),r=null==n?void 0:n.message,o=null==n||null===(t=n.details)||void 0===t?void 0:t.message,l=null==n||null===(a=n.details)||void 0===a?void 0:a.verboseMessage;return r?(0,g.jsx)("div",{className:"gf-form-group p-t-2",children:(0,g.jsx)(h.Alert,{severity:s?"error":"success",title:r,"aria-label":d.wl.pages.DataSource.alert,children:(null==n?void 0:n.details)&&(0,g.jsxs)(g.Fragment,{children:[o,l?(0,g.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:l}):null]})})}):null}function q(e){let{uid:t,pageId:a}=e;(0,c.E)(t);const n=(0,o.useDispatch)(),s=(0,c.wl)(t),r=(0,c.Qs)(s.type),l=(0,c._l)(),i=(0,c.YY)(t),u=(0,c.IA)(t),d=(0,c.q6)(),h=(0,c.hw)(t),p=(0,c.qj)();return(0,g.jsx)(V,{pageId:a,dataSource:s,dataSourceMeta:r,dataSourceSettings:l,dataSourceRights:i,exploreUrl:u,onDelete:d,onDefaultChange:e=>n((0,c.yr)(e)),onNameChange:e=>n((0,c.BX)(e)),onOptionsChange:e=>n((0,c.rl)(e)),onTest:h,onUpdate:p})}function V(e){var t,a,n;let{pageId:s,dataSource:r,dataSourceMeta:o,dataSourceSettings:c,dataSourceRights:u,exploreUrl:d,onDelete:h,onDefaultChange:f,onNameChange:m,onOptionsChange:x,onTest:v,onUpdate:S}=e;const{plugin:j,loadError:y,testingStatus:w,loading:k}=c,{readOnly:N,hasWriteRights:B,hasDeleteRights:E}=u,R=r.id>0,q=null===(t=(0,l.getDataSourceSrv)())||void 0===t?void 0:t.getInstanceSettings(r.uid),V=Boolean(null!==(a=null==q||null===(n=q.meta)||void 0===n?void 0:n.alerting)&&void 0!==a&&a),Y="alertmanager"===(null==q?void 0:q.type),$=V||Y,G=async e=>{e.preventDefault(),await S(Object.assign({},r)),v()};return y?(0,g.jsx)(I,{dataSourceRights:u,onDelete:h}):k?O||(O=(0,g.jsx)(i.Z,{})):R?s?(0,g.jsx)(M,{pageId:s,plugin:j}):(0,g.jsxs)("form",{onSubmit:G,children:[!B&&(A||(A=(0,g.jsx)(P,{}))),N&&(U||(U=(0,g.jsx)(C,{}))),o.state&&(0,g.jsx)(W,{state:o.state}),(0,g.jsx)(D,{dataSource:r}),(0,g.jsx)(p,{dataSourceName:r.name,isDefault:r.isDefault,onDefaultChange:f,onNameChange:m,alertingSupported:$}),j&&(0,g.jsx)(T,{plugin:j,dataSource:r,dataSourceMeta:o,onModelChange:x}),(0,g.jsx)(F,{testingStatus:w}),(0,g.jsx)(b,{onSubmit:G,onDelete:h,onTest:v,exploreUrl:d,canSave:!N&&B,canDelete:!N&&E})]}):null}},52772:(e,t,a)=>{a.d(t,{Vj:()=>o,rl:()=>T.rl,mt:()=>m.mt,r7:()=>m.r7,IO:()=>m.IO,I5:()=>m.I5,BX:()=>T.BX,Ht:()=>T.Ht,zT:()=>T.zT,yr:()=>T.yr,nH:()=>y,wl:()=>w,IA:()=>k,Qs:()=>I,YY:()=>N,_l:()=>P,MF:()=>M,d7:()=>B,q6:()=>C,E:()=>x,wi:()=>S,OU:()=>j,zJ:()=>b,hw:()=>v,qj:()=>D});var n=a(4643),s=(a(57235),a(68404)),r=a(78507);const o=(0,s.createContext)(r.n);var l=a(18745),i=a(43215),c=a(45193),u=a(5831),d=a(98163),h=a(8674),g=a(47570),p=a(21169),f=a(7947),m=a(77197);const x=e=>{const t=(0,l.useDispatch)();(0,s.useEffect)((()=>(t((0,n.M9)(e)),function(){t((0,c.e)({stateSelector:e=>e.dataSourceSettings}))})),[e,t])},v=e=>{const t=(0,l.useDispatch)();return()=>t((0,n.kY)(e))},b=()=>{const e=(0,l.useDispatch)();(0,s.useEffect)((()=>{e((0,n.bZ)())}),[e])},S=e=>{const t=(0,l.useDispatch)();(0,s.useEffect)((()=>{t((0,n.gv)(e))}),[t,e])},j=()=>{const e=(0,l.useDispatch)();(0,s.useEffect)((()=>{e((0,n.Kj)())}),[e])},y=()=>{const e=(0,l.useDispatch)(),t=B();return a=>{e((0,n.J_)(a,t.Edit))}},D=()=>{const e=(0,l.useDispatch)();return t=>e((0,n.oe)(t))},C=()=>{const e=(0,l.useDispatch)(),{name:t}=(0,l.useSelector)((e=>e.dataSources.dataSource));return()=>{u.Z.publish(new p.VJ({title:"Delete",text:`Are you sure you want to delete the "${t}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>e((0,n.F5)())}))}},w=e=>(0,l.useSelector)((t=>(0,m.f6)(t.dataSources,e))),k=e=>{const t=w(e),a=JSON.stringify({datasource:t.name,context:"explore"});return i.urlUtil.renderUrl("/explore",{left:a})},I=e=>(0,l.useSelector)((t=>(0,m.G4)(t.dataSources,e))),P=()=>(0,l.useSelector)((e=>e.dataSourceSettings)),M=(e,t)=>{const a=w(e),{plugin:n,loadError:s,loading:r}=P(),o=(0,l.useSelector)((e=>e.navIndex)),i=t?`datasource-page-${t}`:`datasource-settings-${e}`;if(s){const e={text:s,subTitle:"Data Source Error",icon:"exclamation-triangle"};return{node:e,main:e}}return r||!n?(0,h.h)(o,i,(0,f.xG)("settings")):(0,h.h)(o,i,(0,f.nI)((0,f.B1)(a,n),t||"settings"))},N=e=>{const t=w(e);return{readOnly:!0===t.readOnly,hasWriteRights:d.Vt.hasPermissionInMetadata(g.bW.DataSourcesWrite,t),hasDeleteRights:d.Vt.hasPermissionInMetadata(g.bW.DataSourcesDelete,t)}},B=()=>(0,s.useContext)(o);var T=a(75375)},30978:(e,t,a)=>{a.d(t,{u:()=>o});a(68404);var n=a(43215),s=a(3490),r=a(45916);const o=e=>{const t=function(e){switch(e){case n.PluginState.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case n.PluginState.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case n.PluginState.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,r.jsx)(s.Badge,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=5477.a1ad9c911e843d6ee683.js.map